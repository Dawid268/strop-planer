<div
  class="editor-toolbar flex flex-column gap-0 bg-white border-bottom-1 border-100 shadow-1"
>
  <!-- Row 1: Main Tools -->
  <div class="flex align-items-center gap-2 p-2 w-full">
    <!-- Tools -->
    <p-selectButton
      [options]="toolOptions"
      [ngModel]="store.activeTool()"
      (ngModelChange)="setTool($event)"
      optionValue="value"
      class="tool-group"
    >
      <ng-template pTemplate="item" let-item>
        <i
          [class]="item.icon"
          [pTooltip]="item.tooltipKey | transloco"
          tooltipPosition="bottom"
        ></i>
      </ng-template>
    </p-selectButton>

    <p-button
      icon="pi pi-wand"
      [text]="true"
      [rounded]="true"
      [pTooltip]="'editor.actions.autoLayout' | transloco"
      tooltipPosition="bottom"
      (click)="generateAutoLayout()"
      [disabled]="!store.allShapes().length"
    ></p-button>

    <p-button
      icon="pi pi-qrcode"
      [text]="true"
      [rounded]="true"
      [pTooltip]="'editor.actions.autoTrace' | transloco"
      tooltipPosition="bottom"
      (click)="store.autoTracePdf()"
      [disabled]="!store.backgroundUrl || !store.backgroundUrl()"
    ></p-button>

    <p-divider layout="vertical"></p-divider>

    <!-- Zoom controls -->
    <div class="zoom-controls flex align-items-center gap-1">
      <p-button
        icon="pi pi-minus"
        [text]="true"
        [rounded]="true"
        (click)="zoomOut()"
        [pTooltip]="'editor.actions.zoomOut' | transloco"
        tooltipPosition="bottom"
      ></p-button>
      <span
        class="zoom-label text-sm text-600 font-medium px-2 min-w-4rem text-center"
      >
        {{ store.zoom() * 100 | number: "1.0-0" }}%
      </span>
      <p-button
        icon="pi pi-plus"
        [text]="true"
        [rounded]="true"
        (click)="zoomIn()"
        [pTooltip]="'editor.actions.zoomIn' | transloco"
        tooltipPosition="bottom"
      ></p-button>
      <p-button
        icon="pi pi-expand"
        [text]="true"
        [rounded]="true"
        (click)="resetView()"
        [pTooltip]="'editor.actions.fitToScreen' | transloco"
        tooltipPosition="bottom"
      ></p-button>
    </div>

    <p-divider layout="vertical"></p-divider>

    <!-- Grid & Snap -->
    <div class="grid-controls flex gap-1">
      <p-button
        [icon]="store.showGrid() ? 'pi pi-th-large' : 'pi pi-table'"
        [text]="true"
        [rounded]="true"
        [severity]="store.showGrid() ? 'primary' : 'secondary'"
        (click)="store.toggleGrid()"
        [pTooltip]="'editor.actions.toggleGrid' | transloco"
        tooltipPosition="bottom"
      ></p-button>
      <p-button
        icon="pi pi-magnet"
        [text]="true"
        [rounded]="true"
        [severity]="store.snapToGrid() ? 'primary' : 'secondary'"
        (click)="store.toggleSnapToGrid()"
        [pTooltip]="'editor.actions.toggleSnap' | transloco"
        tooltipPosition="bottom"
      ></p-button>
    </div>

    <p-divider layout="vertical"></p-divider>

    <!-- Canvas Rotation -->
    <div class="rotation-controls flex gap-1">
      <p-button
        icon="pi pi-undo"
        [text]="true"
        [rounded]="true"
        (click)="rotateCanvasLeft.emit()"
        [pTooltip]="'editor.actions.rotateLeft' | transloco"
        tooltipPosition="bottom"
      ></p-button>
      <p-button
        icon="pi pi-refresh"
        [text]="true"
        [rounded]="true"
        (click)="rotateCanvasRight.emit()"
        [pTooltip]="'editor.actions.rotateRight' | transloco"
        tooltipPosition="bottom"
      ></p-button>
    </div>

    <!-- Spacer -->
    <div class="flex-grow-1"></div>

    <!-- Export Button -->
    <p-button
      [label]="'editor.actions.exportSelected' | transloco"
      icon="pi pi-external-link"
      [text]="false"
      [outlined]="true"
      [rounded]="true"
      severity="secondary"
      [disabled]="store.selectedIds().length === 0"
      [pTooltip]="'editor.tooltips.exportSelected' | transloco"
      tooltipPosition="bottom"
      (click)="store.exportToNewTab()"
      class="mr-2"
    ></p-button>

    <!-- Projected Content (e.g. DXF toggle) -->
    <ng-content></ng-content>

    <p-divider layout="vertical"></p-divider>

    <!-- Actions -->
    <p-button
      [label]="'common.save' | transloco"
      icon="pi pi-save"
      (click)="save.emit()"
      class="font-bold"
    ></p-button>

    <!-- Info -->
    <div
      class="selection-info text-sm text-600 px-2 border-left-1 border-100 ml-2"
    >
      @if (store.selectedIds().length > 0) {
        <span
          >{{ "editor.selected" | transloco }}:
          {{ store.selectedIds().length }}</span
        >
      }
    </div>
  </div>

  <!-- Row 2: View Isolation Tabs (Only if slab exists) -->
  @if (store.isSlabDefined()) {
    <div
      class="w-full flex justify-content-center align-items-center gap-3 bg-gray-50 border-top-1 border-200 p-1"
    >
      <p-selectButton
        [options]="viewModeOptions"
        [ngModel]="store.viewMode()"
        (ngModelChange)="setViewMode($event)"
        optionLabel="label"
        optionValue="value"
      >
        <ng-template pTemplate="item" let-item>
          <i [class]="item.icon" class="mr-2"></i>
          <span class="font-medium">{{ item.labelKey | transloco }}</span>
        </ng-template>
      </p-selectButton>

      @if (store.viewMode() === "slab") {
        <p-button
          [label]="'editor.actions.generateOptimal' | transloco"
          icon="pi pi-cog"
          [text]="false"
          [outlined]="false"
          [rounded]="true"
          severity="success"
          [pTooltip]="'editor.tooltips.generateOptimal' | transloco"
          tooltipPosition="bottom"
          (click)="generateOptimalLayout()"
        ></p-button>
      }
    </div>
  }
</div>
