<div class="flex flex-column gap-4 p-1">
  <div
    class="file-upload-area relative border-2 border-dashed border-300 border-round-lg p-6 transition-colors transition-duration-200"
    role="button"
    tabindex="0"
    (click)="fileInput.click()"
    (keydown.enter)="fileInput.click()"
    (keydown.space)="fileInput.click(); $event.preventDefault()"
    (drop)="onDrop($event)"
    (dragover)="onDragOver($event)"
    [class.surface-hover]="isDragging()"
    [class.border-primary]="isDragging()"
    [attr.aria-label]="'projects.new.dragDrop' | transloco"
  >
    @if (isUploading()) {
      <div
        class="absolute inset-0 bg-white-alpha-80 z-10 flex flex-column align-items-center justify-content-center"
      >
        <p-progressSpinner
          styleClass="w-3rem h-3rem"
          strokeWidth="4"
        ></p-progressSpinner>
        <p class="mt-2 text-sm text-600 font-medium">
          {{ "projects.new.fileProcessing" | transloco }}
        </p>
      </div>
    }

    <input
      #fileInput
      type="file"
      (change)="onFileSelected($event)"
      accept=".pdf"
      hidden
    />

    <div
      class="flex flex-column align-items-center justify-content-center text-center cursor-pointer"
    >
      @if (selectedPdfFiles().length > 0) {
        <i class="pi pi-check-circle text-green-500 text-5xl mb-3"></i>
        <p class="font-bold text-900 m-0">
          {{ selectedPdfFiles()[0].name }}
        </p>
        <p class="text-xs text-500 mt-2">
          {{ "projects.new.clickToChange" | transloco }}
        </p>
      } @else {
        <i class="pi pi-cloud-upload text-400 text-5xl mb-3"></i>
        <p class="font-bold text-900 m-0">
          {{ "projects.new.dragDrop" | transloco }}
        </p>
        <p class="text-xs text-500 mt-2">
          {{ "projects.new.supportedFormats" | transloco }}
        </p>
      }
    </div>
  </div>

  <div class="flex flex-column gap-3">
    <div class="flex flex-column gap-2">
      <label for="name" class="font-medium text-900">{{
        "projects.projectName" | transloco
      }}</label>
      <input
        id="name"
        pInputText
        [ngModel]="project().name"
        (ngModelChange)="updateName($event)"
        name="name"
        required
        [placeholder]="'projects.new.namePlaceholder' | transloco"
        class="w-full"
      />
    </div>

    <div class="flex flex-column gap-2">
      <label for="description" class="font-medium text-900"
        >{{ "projects.description" | transloco }} ({{
          "common.optional" | transloco
        }})</label
      >
      <textarea
        id="description"
        pInputTextarea
        [ngModel]="project().description"
        (ngModelChange)="updateDescription($event)"
        name="description"
        [autoResize]="true"
        rows="3"
        class="w-full"
      ></textarea>
    </div>
  </div>

  <!-- Creation Progress Overlay -->
  @if (isCreating()) {
    <div
      class="creation-overlay p-4 bg-blue-50 border-round border-1 border-blue-200 mt-2"
    >
      <div class="flex justify-content-between mb-2">
        <span class="text-sm font-bold text-blue-700">{{
          creationStatus()
        }}</span>
        <span class="text-sm font-bold text-blue-700"
          >{{ creationProgress() }}%</span
        >
      </div>
      <p-progressBar
        [value]="creationProgress()"
        [showValue]="false"
        styleClass="h-1rem border-round"
      ></p-progressBar>
    </div>
  }
  @if (localError()) {
    <p-message
      severity="error"
      [text]="localError() || ''"
      styleClass="w-full mt-2"
    ></p-message>
  }

  <div class="flex justify-content-end gap-2 mt-4">
    <button
      pButton
      type="button"
      [label]="'common.cancel' | transloco"
      [attr.aria-label]="'common.cancel' | transloco"
      class="p-button-text p-button-secondary font-bold"
      (click)="ref.close()"
      [disabled]="isCreating() || isUploading()"
    ></button>
    <button
      pButton
      type="button"
      [label]="'projects.createProject' | transloco"
      [attr.aria-label]="'projects.createProject' | transloco"
      class="font-bold px-4"
      (click)="submit()"
      [loading]="isCreating()"
    ></button>
  </div>
</div>
